# GeoGLI Chatbot - Difyé›†æˆæ¶æ„

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Dify Platform                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Dify Workflow                          â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Input   â”‚â”€â”€â”€â–¶â”‚   HTTP   â”‚â”€â”€â”€â–¶â”‚  Output  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Node    â”‚    â”‚  Request â”‚    â”‚   Node   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                        â”‚                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/HTTPS
                            â”‚ POST /api/dify/chat
                            â”‚ POST /api/dify/recognize
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GeoGLI Chatbot Microservice                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              FastAPI Application                     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚  â”‚  /api/dify/    â”‚  â”‚  /api/dify/    â”‚           â”‚  â”‚
â”‚  â”‚  â”‚  chat          â”‚  â”‚  recognize     â”‚           â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚  â”‚          â”‚                    â”‚                    â”‚  â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚                   â”‚                                â”‚  â”‚
â”‚  â”‚                   â–¼                                â”‚  â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚          â”‚  Router Graph   â”‚                       â”‚  â”‚
â”‚  â”‚          â”‚  (LangGraph)    â”‚                       â”‚  â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â”‚                   â”‚                                â”‚  â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚          â–¼                 â–¼                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚  BM25 Search â”‚  â”‚  Intent      â”‚              â”‚  â”‚
â”‚  â”‚  â”‚  Engine      â”‚  â”‚  Recognition â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚         â”‚                 â”‚                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                 â”‚                          â”‚
â”‚            â–¼                 â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Data Layer                             â”‚  â”‚
â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”‚
â”‚  â”‚  â”‚  BM25 Index  â”‚  â”‚  SQLite DB   â”‚            â”‚  â”‚
â”‚  â”‚  â”‚  (corpus/)   â”‚  â”‚  (sessions)  â”‚            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ è¯·æ±‚æµç¨‹

### æµç¨‹1: ç®€å•é—®ç­” (Chat API)

```
User Query
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify Workflow  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ POST /api/dify/chat
         â”‚ {"query": "Saudi Arabia drought"}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeoGLI Backend                     â”‚
â”‚                                     â”‚
â”‚  1. Receive Request                 â”‚
â”‚     â”œâ”€ Validate input               â”‚
â”‚     â””â”€ Generate session_id          â”‚
â”‚                                     â”‚
â”‚  2. Intent Routing                  â”‚
â”‚     â”œâ”€ Extract keywords             â”‚
â”‚     â”œâ”€ Identify country/region      â”‚
â”‚     â””â”€ Determine domain             â”‚
â”‚                                     â”‚
â”‚  3. BM25 Search                     â”‚
â”‚     â”œâ”€ Query BM25 index             â”‚
â”‚     â”œâ”€ Retrieve top-k documents     â”‚
â”‚     â””â”€ Score and rank results       â”‚
â”‚                                     â”‚
â”‚  4. Format Response                 â”‚
â”‚     â”œâ”€ Extract relevant text        â”‚
â”‚     â”œâ”€ Add metadata                 â”‚
â”‚     â””â”€ Include visualizations       â”‚
â”‚                                     â”‚
â”‚  5. Return JSON                     â”‚
â”‚     â””â”€ {answer, metadata, ...}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify Workflow  â”‚
â”‚  Display Answer â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ—¶é—´çº¿**:
- 0ms: æ¥æ”¶è¯·æ±‚
- 10ms: æ„å›¾è¯†åˆ«å®Œæˆ
- 50ms: BM25æœç´¢å®Œæˆ
- 100ms: å“åº”æ ¼å¼åŒ–
- 150ms: è¿”å›ç»“æœ

### æµç¨‹2: æ„å›¾è¯†åˆ« + è·¯ç”± (Recognize + Chat)

```
User Query
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify: HTTP Request (recognize)     â”‚
â”‚  POST /api/dify/recognize           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeoGLI: Intent Recognition         â”‚
â”‚  Returns: {                         â”‚
â”‚    domain: "country_profile",       â”‚
â”‚    targets: ["saudi arabia"],       â”‚
â”‚    iso3_codes: ["SAU"],             â”‚
â”‚    section_hint: "stressors/fires"  â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify: IF/ELSE Node                 â”‚
â”‚  Route by domain:                   â”‚
â”‚  â”œâ”€ country_profile â†’ Branch A      â”‚
â”‚  â”œâ”€ legislation â†’ Branch B          â”‚
â”‚  â””â”€ commitment â†’ Branch C           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify: HTTP Request (chat)          â”‚
â”‚  POST /api/dify/chat                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeoGLI: Generate Answer            â”‚
â”‚  Returns: {                         â”‚
â”‚    answer: "...",                   â”‚
â”‚    metadata: {...}                  â”‚
â”‚  }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dify: Format & Output              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ç»„ä»¶è¯¦è§£

### 1. API Layer (FastAPI)

```python
# backend/app/routes/dify.py

@router.post("/api/dify/chat")
async def dify_chat(request, body):
    """
    ä¸»è¦èŠå¤©æ¥å£
    - æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢
    - è°ƒç”¨åç«¯å¤„ç†é€»è¾‘
    - è¿”å›æ ¼å¼åŒ–ç­”æ¡ˆ
    """
    
@router.post("/api/dify/recognize")
async def dify_recognize(request, body):
    """
    æ„å›¾è¯†åˆ«æ¥å£
    - æå–å®ä½“(å›½å®¶/åœ°åŒº)
    - è¯†åˆ«é¢†åŸŸ(country_profile/legislation/commitment)
    - è¿”å›ç»“æ„åŒ–ä¿¡æ¯
    """
```

### 2. Router Graph (LangGraph)

```python
# backend/app/router_graph.py

def create_graph():
    """
    åˆ›å»ºè·¯ç”±å›¾
    - æ„å›¾åˆ†ç±»
    - BM25æœç´¢
    - ç­”æ¡ˆç”Ÿæˆ
    """
    graph = StateGraph(GraphState)
    graph.add_node("route", route_query)
    graph.add_node("bm25_search", bm25_search)
    graph.add_node("generate", generate_answer)
    return graph
```

### 3. BM25 Search Engine

```python
# backend/app/search/bm25_store.py

class BM25Store:
    """
    BM25æœç´¢å¼•æ“
    - åŠ è½½é¢„æ„å»ºç´¢å¼•
    - æ‰§è¡Œå…³é”®è¯æœç´¢
    - è¿”å›ç›¸å…³æ–‡æ¡£
    """
    def search(self, query, top_k=3):
        scores = self.bm25.get_scores(query_tokens)
        top_indices = np.argsort(scores)[-top_k:]
        return [self.documents[i] for i in top_indices]
```

### 4. Intent Recognition

```python
# backend/app/search/router_intent.py

def route(query: str) -> dict:
    """
    æ„å›¾è¯†åˆ«
    - æå–å›½å®¶/åœ°åŒºåç§°
    - è¯†åˆ«ISO3ä»£ç 
    - ç¡®å®šæŸ¥è¯¢é¢†åŸŸ
    """
    return {
        "intent": "ask.country",
        "country": "saudi arabia",
        "iso3": "SAU",
        "domain": "country_profile"
    }
```

## ğŸ”Œ æ•°æ®æµ

### Chat APIæ•°æ®æµ

```
Input:
{
  "query": "Saudi Arabia drought",
  "conversation_id": "session_123"
}
    â”‚
    â–¼
[Validation]
    â”‚
    â–¼
[Intent Recognition]
    â”‚ intent: "ask.country"
    â”‚ country: "saudi arabia"
    â”‚ iso3: "SAU"
    â–¼
[BM25 Search]
    â”‚ top_k: 3 documents
    â”‚ scores: [0.85, 0.72, 0.68]
    â–¼
[Format Response]
    â”‚
    â–¼
Output:
{
  "answer": "æ ¹æ®æ•°æ®æ˜¾ç¤º...",
  "metadata": {
    "intent": "ask.country",
    "hits": [...],
    "latency_ms": 150
  },
  "conversation_id": "session_123"
}
```

### Recognize APIæ•°æ®æµ

```
Input:
{
  "query": "Saudi Arabia wildfires"
}
    â”‚
    â–¼
[NLP Processing]
    â”‚ Tokenization
    â”‚ Entity Recognition
    â”‚ Domain Classification
    â–¼
[Slot Filling]
    â”‚ targets: ["saudi arabia"]
    â”‚ iso3_codes: ["SAU"]
    â”‚ domain: "country_profile"
    â”‚ section_hint: "stressors/fires"
    â–¼
Output:
{
  "targets": ["saudi arabia"],
  "domain": "country_profile",
  "section_hint": "stressors/fires",
  "iso3_codes": ["SAU"],
  "query": "Saudi Arabia wildfires"
}
```

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨

### æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ data/                          # é™æ€æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ geogli/                    # GeoGLIæ•°æ®
â”‚   â”‚   â”œâ”€â”€ snapshots/             # å¯è§†åŒ–å›¾è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ SAU_fires.png
â”‚   â”‚   â”‚   â””â”€â”€ CHN_drought.png
â”‚   â”‚   â””â”€â”€ citations/             # å¼•ç”¨æ–‡æ¡£
â”‚   â”‚       â”œâ”€â”€ SAU_profile.md
â”‚   â”‚       â””â”€â”€ CHN_profile.md
â”‚   â”‚
â”‚   â”œâ”€â”€ legislation/               # æ³•å¾‹æ•°æ®
â”‚   â”‚   â””â”€â”€ documents/
â”‚   â”‚
â”‚   â””â”€â”€ commitments/               # æ‰¿è¯ºæ•°æ®
â”‚       â””â”€â”€ documents/
â”‚
â”œâ”€â”€ corpus/                        # BM25ç´¢å¼•
â”‚   â”œâ”€â”€ geogli.json
â”‚   â”œâ”€â”€ legislation.json
â”‚   â””â”€â”€ commitments.json
â”‚
â””â”€â”€ chatbot.db                     # SQLiteæ•°æ®åº“
    â””â”€â”€ sessions                   # ä¼šè¯è®°å½•
```

### æ•°æ®åº“Schema

```sql
-- sessionsè¡¨
CREATE TABLE sessions (
    id TEXT PRIMARY KEY,
    created_at TIMESTAMP,
    last_activity TIMESTAMP,
    metadata JSON
);

-- messagesè¡¨
CREATE TABLE messages (
    id INTEGER PRIMARY KEY,
    session_id TEXT,
    role TEXT,  -- 'user' or 'assistant'
    content TEXT,
    created_at TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES sessions(id)
);
```

## ğŸ” å®‰å…¨æ¶æ„

```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reverse Proxy  â”‚  â† HTTPSç»ˆæ­¢
â”‚  (Nginx/Caddy)  â”‚  â† é€Ÿç‡é™åˆ¶
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â† IPè¿‡æ»¤
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Gateway    â”‚  â† API KeyéªŒè¯
â”‚  (Optional)     â”‚  â† è¯·æ±‚æ—¥å¿—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeoGLI Backend             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CORS Middleware    â”‚   â”‚  â† OriginéªŒè¯
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Input Validation   â”‚   â”‚  â† é•¿åº¦é™åˆ¶
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â† å†…å®¹è¿‡æ»¤
â”‚             â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Business Logic     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

```
Request
    â”‚
    â–¼
[Check Cache]
    â”‚
    â”œâ”€ Hit â†’ Return cached response (5ms)
    â”‚
    â””â”€ Miss
        â”‚
        â–¼
    [Process Request]
        â”‚
        â–¼
    [Store in Cache]
        â”‚
        â–¼
    [Return Response] (150ms)
```

### è´Ÿè½½å‡è¡¡

```
Dify Requests
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Load Balancer  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Backend â”‚ â”‚Backend â”‚ â”‚Backend â”‚
â”‚   #1   â”‚ â”‚   #2   â”‚ â”‚   #3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ç›‘æ§æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Monitoring Stack                   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Prometheus  â”‚ â† Metrics        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Grafana    â”‚ â† Dashboards     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚     Logs     â”‚ â† Docker logs    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²
         â”‚ Metrics & Logs
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeoGLI Backend  â”‚
â”‚  - Request count â”‚
â”‚  - Latency       â”‚
â”‚  - Error rate    â”‚
â”‚  - Cache hit rateâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ

```
Developer Machine
    â”‚
    â”œâ”€ backend/          (Python + FastAPI)
    â”œâ”€ frontend/         (HTML/CSS/JS)
    â””â”€ docker-compose.yml
```

### ç”Ÿäº§ç¯å¢ƒ

```
Cloud Server (e.g., DigitalOcean, AWS)
    â”‚
    â”œâ”€ Docker Container: GeoGLI Backend
    â”‚   â””â”€ Port 8000
    â”‚
    â”œâ”€ Docker Container: Nginx
    â”‚   â””â”€ Port 80/443
    â”‚
    â””â”€ Volume: /data
        â”œâ”€ BM25 indices
        â”œâ”€ Visualizations
        â””â”€ Database
```

## ğŸ“ˆ æ‰©å±•è·¯å¾„

### å‚ç›´æ‰©å±•

```
Single Server
    â”‚
    â”œâ”€ Increase CPU cores
    â”œâ”€ Increase RAM
    â””â”€ Optimize BM25 index
```

### æ°´å¹³æ‰©å±•

```
Multiple Servers
    â”‚
    â”œâ”€ Load Balancer
    â”‚   â””â”€ Distribute requests
    â”‚
    â”œâ”€ Shared Storage (NFS/S3)
    â”‚   â””â”€ BM25 indices
    â”‚
    â””â”€ Shared Database (PostgreSQL)
        â””â”€ Session data
```

---

**æ¶æ„ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-11-28  
**ç»´æŠ¤**: GeoGLI Team
